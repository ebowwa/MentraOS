#
# Merged XIP Configuration for External SPI NOR Flash
# Based on prj.conf with XIP-specific additions
#

# Enable the UART driver
CONFIG_UART_ASYNC_API=y
CONFIG_NRFX_UARTE0=y
CONFIG_SERIAL=y

CONFIG_GPIO=y

# High-Frequency Clock Configuration for SPI Performance
CONFIG_CLOCK_CONTROL=y
CONFIG_CLOCK_CONTROL_NRF=y
# Enable NRFX clock driver for 128MHz configuration
CONFIG_NRFX_CLOCK=y
# Enable high-frequency external crystal for better SPI timing
CONFIG_SYSTEM_CLOCK_NO_WAIT=y

# Make sure printk is printing to the UART console
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y

CONFIG_HEAP_MEM_POOL_SIZE=8192

CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="NexSim"
CONFIG_BT_MAX_CONN=1
CONFIG_BT_MAX_PAIRED=1

# Enable BLE GATT
CONFIG_BT_GATT_SERVICE_CHANGED=y

# Enable advertising
CONFIG_BT_BROADCASTER=y
CONFIG_BT_EXT_ADV=n

# Increase buffer sizes for protobuf messages
CONFIG_BT_L2CAP_TX_MTU=247
CONFIG_BT_BUF_ACL_RX_SIZE=251
CONFIG_BT_BUF_ACL_TX_SIZE=251

# Enable BT data length update
CONFIG_BT_DATA_LEN_UPDATE=y
CONFIG_BT_AUTO_DATA_LEN_UPDATE=y

# Enable BT PHY update
CONFIG_BT_PHY_UPDATE=y
CONFIG_BT_AUTO_PHY_UPDATE=y

# Enable DMIC/PDM for digital microphone input
CONFIG_AUDIO=y
CONFIG_AUDIO_DMIC=y

# Additional display/audio configurations from base prj.conf
CONFIG_DISPLAY=y
CONFIG_LVGL=y
CONFIG_LV_COLOR_DEPTH_1=y
CONFIG_LV_MEM_CUSTOM=y
CONFIG_LV_USE_LOG=y
CONFIG_LV_LOG_LEVEL_WARN=y
CONFIG_LV_THEME_BASIC=y
CONFIG_LV_USE_THEME_BASIC=y
CONFIG_LV_THEME_DEFAULT_DARK=y
CONFIG_LV_COLOR_CHROMA_KEY_HEX=0x00FF00

# Enable custom HLS12VGA Display Driver for projector testing  
CONFIG_CUSTOM_HLS12VGA=y

# SPI Support for Display with High-Frequency Optimization
CONFIG_SPI=y
CONFIG_SPI_ASYNC=y

# LVGL Fonts - Keep minimal set to save FLASH memory
CONFIG_LV_FONT_MONTSERRAT_12=y
CONFIG_LV_FONT_MONTSERRAT_14=y

# Unicode and Font support
CONFIG_LV_USE_FONT_COMPRESSED=y
CONFIG_LV_FONT_FMT_TXT_LARGE=y
CONFIG_LV_TXT_ENC_UTF8=y
CONFIG_LV_FONT_SIMSUN_14_CJK=y

# Power Management
CONFIG_PM_DEVICE=y

# PDM Audio Configuration for Microphone Input
CONFIG_AUDIO_DMIC_NRFX_PDM=y

# LC3 Codec Configuration for Audio Streaming  
CONFIG_AUDIO_CODEC=y

# Math library for audio processing
CONFIG_NEWLIB_LIBC=y
CONFIG_FPU=y
CONFIG_CMSIS_DSP=y
CONFIG_SW_CODEC_LC3_T2_SOFTWARE=y
CONFIG_LC3_ENC_CHAN_MAX=2
CONFIG_LC3_DEC_CHAN_MAX=2

CONFIG_NRFX_I2S0=y
CONFIG_USER_STEREO_1RX_L_1RX_R=y

CONFIG_BT_USER_PHY_UPDATE=y
CONFIG_BT_USER_DATA_LEN_UPDATE=y

# XIP-specific configurations
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=4096
CONFIG_CBPRINTF_FP_SUPPORT=y
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_RTT_CONSOLE=y

# Logging configurations
CONFIG_LOG_BUFFER_SIZE=8192
CONFIG_LOG_MODE_IMMEDIATE=n 
CONFIG_LOG_MODE_DEFERRED=y

# Display configurations
CONFIG_SSD1306=y
CONFIG_I2C=y
CONFIG_DISPLAY_LOG_LEVEL_DBG=y

CONFIG_TFM_SECURE_UART=n
CONFIG_TFM_LOG_LEVEL_SILENCE=y

# Shell configurations - essential for XIP shell commands
CONFIG_SHELL=y
CONFIG_LOG_CMDS=y
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_PROMPT_UART="nrf5340:~$ "
CONFIG_SHELL_CMD_BUFF_SIZE=256
CONFIG_SHELL_PRINTF_BUFF_SIZE=64
CONFIG_SHELL_BACKEND_SERIAL_TX_RING_BUFFER_SIZE=4096
CONFIG_SHELL_STACK_SIZE=8192

# External Flash Support for XIP
CONFIG_NORDIC_QSPI_NOR=y
CONFIG_NORDIC_QSPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_NORDIC_QSPI_NOR_STACK_WRITE_BUFFER_SIZE=16

# XIP (eXecute In Place) Configuration
CONFIG_XIP=y
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096

# Flash Configuration for XIP
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_STREAM_FLASH=y

# LittleFS Configuration for External Flash
CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_LITTLEFS=y

# Enable QSPI Performance Optimization
CONFIG_NORDIC_QSPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_NORDIC_QSPI_NOR_STACK_WRITE_BUFFER_SIZE=16

# Bootloader Configuration for XIP
CONFIG_BOOTLOADER_MCUBOOT=y
CONFIG_IMG_MANAGER=y
CONFIG_IMG_ERASE_PROGRESSIVELY=y