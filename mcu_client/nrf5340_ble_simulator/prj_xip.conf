#
# XIP (eXecute In Place) Configuration for External SPI NOR Flash
# Based on prj.conf with XIP-specific additions
#

# Include base configuration
include prj.conf

# External Flash Support
CONFIG_NORDIC_QSPI_NOR=y
CONFIG_NORDIC_QSPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_NORDIC_QSPI_NOR_STACK_WRITE_BUFFER_SIZE=16

# XIP (eXecute In Place) Configuration
CONFIG_XIP=y
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096

# Flash Configuration for XIP
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_STREAM_FLASH=y

# LittleFS Configuration for External Flash
CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_LITTLEFS=y
CONFIG_LITTLEFS_READ_SIZE=16
CONFIG_LITTLEFS_PROG_SIZE=16
CONFIG_LITTLEFS_CACHE_SIZE=64
CONFIG_LITTLEFS_LOOKAHEAD_SIZE=16
CONFIG_LITTLEFS_BLOCK_SIZE=4096
CONFIG_LITTLEFS_USE_MTIME=y

# Memory Management for XIP
CONFIG_HEAP_MEM_POOL_SIZE=8192
CONFIG_MAIN_STACK_SIZE=4096

# QSPI Performance Optimization
CONFIG_NORDIC_QSPI_NOR_FLASH_LAYOUT_PAGE_SIZE=4096
CONFIG_NORDIC_QSPI_NOR_STACK_WRITE_BUFFER_SIZE=16

# Enable XIP debugging
CONFIG_XIP_DEBUG=y
CONFIG_FLASH_LOG_LEVEL_DBG=y

# Bootloader Configuration for XIP
CONFIG_BOOTLOADER_MCUBOOT=y
CONFIG_IMG_MANAGER=y
CONFIG_IMG_ERASE_PROGRESSIVELY=y

# Partition Manager for XIP
CONFIG_PM_PARTITION_SIZE_MCUBOOT=0x10000
CONFIG_PM_PARTITION_SIZE_XIP=0x400000
CONFIG_PM_PARTITION_SIZE_LITTLEFS_STORAGE=0x400000
